{% extends "base.html" %}

{% block css_override_block %}
    <script src="{{ STATIC_URL }}js/jquery.steps.min.js"></script>
    <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery.steps.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/createsong.css">
{% endblock %}

{% block container %}

<a href="/show">view random song</a>
    <h1>Gif Song</h1>
<form action="/" method="post">
    {{ form.non_field_errors }}
    {% csrf_token %}




<div id="wizard">
                <h2>Image</h2>
                <section>
                    <div class="fieldWrapper">
                        {{ form.image_url.errors }}
                        <label for="id_subject">URL to Image</label>
                        {{ form.image_url }}
                    </div>
                    <p>
                        currently limited to imgur.com
                    </p>
                </section>

                <h2>Song</h2>
                <section>
                    <div class="fieldWrapper">
                        {{ form.audio_url.errors }}
                        <label for="id_message">URL to Audio</label>
                        {{ form.audio_url }}
                    </div>
                    <p>
                        add songs with urls like www.youtube.com/embed/zpmKjJ4YU_c?autoplay=1
                    </p>
                </section>

                <h2>Create</h2>
                <section>
   <input id="submitgifvid" class="yui3-button success" type="submit" value="Create" />

                </section>
            </div>
</form>

    <script>
    $(function(){
        $("#id_image_url").attr("placeholder","http://imgur.com/SVwaAwZ");
        $("#wizard").steps({
            headerTag: "h2",
            bodyTag: "section",
            transitionEffect: "slideLeft",
            height:"300"
        });

        $("#id_image_url").after(
            $("<div/>", {
                "id" : "checkImage",
                "src" : $("#id_image_url").val(),
                "class" : "yui3-button fa fa-eye notice marginTop",
                "text" : " preview"
            })
        );
        $("#checkImage").click(function(){

            //check imgur stuffs
            var image_url = $("#id_image_url").val();
            if (!/^https?:\/\//i.test(image_url)) {
                image_url = 'http://' + image_url;
            }
            if(image_url.indexOf("imgur") > -1 && /^https?:\/\/(?:[a-z\-]+\.)+[a-z]{2,6}(?:\/[^\/#?]+)+\.(?:gif)$/.test(image_url) != true){
                if(image_url.lastIndexOf("/") == (image_url.length - 1)){
                    //remove trailing slash
                    image_url = image_url.substring(0, (image_url.lastIndexOf("/")))
                };
                image_url = image_url.substring(image_url.lastIndexOf("/") + 1);
                image_url = "i.imgur.com/" + image_url + ".gif";
            }

            //ensure it is an image
            if(/^https?:\/\/(?:[a-z\-]+\.)+[a-z]{2,6}(?:\/[^\/#?]+)+\.(?:gif)$/.test(image_url)){
                //gif image is in string with proper url, strip for inserting into db
                image_url = image_url.replace("http://","");
                image_url = image_url.replace("https://","");
            }


            $("#previewImage").remove();
            $("#id_image_url").before(

                $("<img/>", {
                    "id" : "previewImage",
                    "class" : "previewImage",
                    "src" : "http://" + image_url
                })
            );
        });

        $("#id_audio_url").after(
            $("<div/>", {
                "id" : "checkSong",
                "src" : $("#id_image_url").val(),
                "class" : "yui3-button fa fa-volume-up notice marginTop",
                "text" : " preview"
            })
        );
        $("#checkSong").click(function(){
            $("#previewSong").remove();
            $("#id_audio_url").before(
                $("<iframe/>", {
                    "id" : "previewSong",
                    "class" : "previewImage",
                    "frameborder": "0",
                    "src" : "http://" + $("#id_audio_url").val()
                })
            );
        });


    });
    </script>
<div class="footer">
    <div class="doges">
        <div class="copyright">Brought to you by these Doges.</div>
        <a class="circular derek"  href="https://github.com/toxigenicpoem" target="_blank"></a>
        <a class="circular derick"  href="https://github.com/ZephyrXero" target="_blank"></a>
        <a class="circular burns"  href="https://github.com/nthdegreeburns" target="_blank"></a>
        <a class="circular justin"  href="https://github.com/bigjust" target="_blank"></a>
        <a class="circular mannyu"  href="https://github.com/mannyblum" target="_blank"></a>
        <a class="circular matt" href="https://github.com/mlsimpson" target="_blank"></a>
        <a class="circular nolan" href="https://github.com/nrb" target="_blank"></a>
        <div class="clearfix"></div>
        <div class="copyright">Copyright &copy; 2014 Nintendoges</div>
    </div>
</div>
{% endblock %}
